if kconfig.has_key('CONFIG_USE_STM32_DRIVERS') and board_name != 'test'

    # These modules are currently not used by cubemx,
    # which causes them to be disabled every time code
    # is generated by cubemx. To avoid this issue, we
    # force them to be enabled from here.
    hal_stm32_c_args = [
        '-DHAL_CRC_MODULE_ENABLED',
        '-DHAL_IWDG_MODULE_ENABLED',
    ]

    c_args += hal_stm32_c_args

    include_dirs += include_directories('include')
    subdir('src')
endif
